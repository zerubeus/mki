---
import type { translations } from "../i18n/translations";
import { getLocalizedEvents } from "../data/seerahEvents";
import SelectedEventDisplay from "./SelectedEventDisplay.astro";
import SeerahInteractivity from "./SeerahInteractivity.tsx";

type TranslationObject = (typeof translations)[keyof typeof translations];

interface Props {
  t: TranslationObject;
  locale?: "ar" | "en";
}

const { t, locale = "en" } = Astro.props;

// Get initial data server-side
const events = getLocalizedEvents(locale);
const sortedEvents = [...events].sort((a, b) => {
  const yearA = parseInt(a.year.match(/\d+/)?.[0] || "0");
  const yearB = parseInt(b.year.match(/\d+/)?.[0] || "0");
  if (yearA !== yearB) return yearA - yearB;
  return a.id - b.id;
});

// Default to first event
const initialEvent = sortedEvents[0] || null;
---

<div class="min-h-screen flex flex-col p-4 md:p-8 space-y-6">
  <header class="text-center text-white">
    <h1 class="text-3xl md:text-4xl font-bold text-white">
      {t.seerahJourneyTitle}
    </h1>
    <p class="text-sm md:text-md text-gray-200 mt-1">
      {t.seerahJourneySubtitle || "An Interactive Journey Through Seerah"}
    </p>
  </header>

  <main class="flex-grow flex flex-col space-y-6 w-full max-w-5xl mx-auto text-gray-800">
    <!-- Event Display Container - Will be updated by React -->
    <div id="event-display" class="bg-white/90 backdrop-blur-sm p-4 md:p-6 rounded-xl shadow-xl">
      <SelectedEventDisplay event={initialEvent} />
    </div>

    <!-- Interactive components loaded only when visible -->
    <SeerahInteractivity 
      client:visible 
      sortedEvents={sortedEvents} 
      initialEventId={initialEvent?.id || null}
      timelineTitle={t.timelineTitle}
    />
  </main>

  <footer class="text-center text-xs text-gray-300 py-4">
    {t.seerahJourneyFooter ||
      "Map data &copy; OpenStreetMap contributors &copy; CartoDB. Event information compiled for educational purposes."}
  </footer>
</div>